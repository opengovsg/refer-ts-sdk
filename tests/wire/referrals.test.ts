// This file was auto-generated by Fern from our API Definition.

import * as ReferralExchange from "../../src/api/index";
import { ReferralExchangeClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("Referrals", () => {
    test("list (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    id: "id",
                    sender: {
                        hciCode: "hciCode",
                        name: "name",
                        block: "block",
                        streetName: "streetName",
                        buildingName: null,
                        floorNumber: null,
                        unitNumber: null,
                        postalCode: "postalCode",
                    },
                    senderSystem: "HAS",
                    offering: {
                        id: "id",
                        name: "name",
                        institutionHciCode: "institutionHciCode",
                        institution: {
                            hciCode: "hciCode",
                            name: "name",
                            block: "block",
                            streetName: "streetName",
                            buildingName: null,
                            floorNumber: null,
                            unitNumber: null,
                            postalCode: "postalCode",
                        },
                        system: "HAS",
                        description:
                            "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                        isActive: true,
                        isSubsidisable: true,
                        timeslotPolicy: "timeslot-required",
                    },
                    patient: {
                        uin: "uin",
                        name: "name",
                        phoneNumber: "91234567",
                        dob: "1990-01-01",
                        gender: "Male",
                        chasStatus: "chasStatus",
                    },
                    referringDoctor: {
                        mcr: "mcr",
                        idType: "mcr",
                        name: "name",
                        email: "email",
                        contactNumber: "contactNumber",
                    },
                    isSubsidised: true,
                    isUrgent: true,
                    createdAt: "2024-05-01T00:00:00Z",
                    updatedAt: "2024-05-01T00:00:00Z",
                    formResponses: [{ question: "question", id: "id", answer: "answer" }],
                    forms: [
                        {
                            id: "id",
                            url: "url",
                            description: "description",
                            isFilled: true,
                            formResponses: [{ question: "question", id: "id", answer: "answer" }],
                        },
                    ],
                    attachments: [{ url: "url", name: "ecg-report.png" }],
                    url: "url",
                    clinicLicenseNumber: "clinicLicenseNumber",
                    clinicType: "CHAS-only",
                    clinicalInfo: "clinicalInfo",
                    status: "draft",
                    timeslotStartAt: "2024-05-01T00:00:00Z",
                    appointmentLocation: "appointmentLocation",
                    notes: [
                        {
                            id: "id",
                            content: "content",
                            authorHciCode: "authorHciCode",
                            authorName: "authorName",
                            createdAt: 1.1,
                            updatedAt: 1.1,
                        },
                    ],
                },
            ],
            metadata: { hasNext: true, totalCount: 1.1, nextParams: { offset: 1.1, pageSize: 1.1 } },
        };
        server.mockEndpoint().get("/api/v1/referrals").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.referrals.list();
        expect(response).toEqual({
            data: [
                {
                    id: "id",
                    sender: {
                        hciCode: "hciCode",
                        name: "name",
                        block: "block",
                        streetName: "streetName",
                        buildingName: null,
                        floorNumber: null,
                        unitNumber: null,
                        postalCode: "postalCode",
                    },
                    senderSystem: "HAS",
                    offering: {
                        id: "id",
                        name: "name",
                        institutionHciCode: "institutionHciCode",
                        institution: {
                            hciCode: "hciCode",
                            name: "name",
                            block: "block",
                            streetName: "streetName",
                            buildingName: null,
                            floorNumber: null,
                            unitNumber: null,
                            postalCode: "postalCode",
                        },
                        system: "HAS",
                        description:
                            "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                        isActive: true,
                        isSubsidisable: true,
                        timeslotPolicy: "timeslot-required",
                    },
                    patient: {
                        uin: "uin",
                        name: "name",
                        phoneNumber: "91234567",
                        dob: "1990-01-01",
                        gender: "Male",
                        chasStatus: "chasStatus",
                    },
                    referringDoctor: {
                        mcr: "mcr",
                        idType: "mcr",
                        name: "name",
                        email: "email",
                        contactNumber: "contactNumber",
                    },
                    isSubsidised: true,
                    isUrgent: true,
                    createdAt: "2024-05-01T00:00:00Z",
                    updatedAt: "2024-05-01T00:00:00Z",
                    formResponses: [
                        {
                            question: "question",
                            id: "id",
                            answer: "answer",
                        },
                    ],
                    forms: [
                        {
                            id: "id",
                            url: "url",
                            description: "description",
                            isFilled: true,
                            formResponses: [
                                {
                                    question: "question",
                                    id: "id",
                                    answer: "answer",
                                },
                            ],
                        },
                    ],
                    attachments: [
                        {
                            url: "url",
                            name: "ecg-report.png",
                        },
                    ],
                    url: "url",
                    clinicLicenseNumber: "clinicLicenseNumber",
                    clinicType: "CHAS-only",
                    clinicalInfo: "clinicalInfo",
                    status: "draft",
                    timeslotStartAt: "2024-05-01T00:00:00Z",
                    appointmentLocation: "appointmentLocation",
                    notes: [
                        {
                            id: "id",
                            content: "content",
                            authorHciCode: "authorHciCode",
                            authorName: "authorName",
                            createdAt: 1.1,
                            updatedAt: 1.1,
                        },
                    ],
                },
            ],
            metadata: {
                hasNext: true,
                totalCount: 1.1,
                nextParams: {
                    offset: 1.1,
                    pageSize: 1.1,
                },
            },
        });
    });

    test("list (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/api/v1/referrals").respondWith().statusCode(401).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.referrals.list();
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("upsert (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            patient: { uin: "uin", name: "name", phoneNumber: "91234567", dob: "1990-01-01", gender: "Male" },
            offeringId: "offeringId",
            senderHciCode: "senderHciCode",
            senderInstitutionName: "senderInstitutionName",
            doctorMcr: "doctorMcr",
            doctorName: "doctorName",
            doctorEmail: "doctorEmail",
            doctorContactNumber: "doctorContactNumber",
            isSubsidised: true,
            isUrgent: true,
            isDraft: true,
            formResponses: [{ question: "question", id: "id", answer: "answer" }],
        };
        const rawResponseBody = {
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [{ question: "question", id: "id", answer: "answer" }],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [{ question: "question", id: "id", answer: "answer" }],
                },
            ],
            attachments: [{ url: "url", name: "ecg-report.png" }],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/api/v1/referrals")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.referrals.upsert({
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
            },
            offeringId: "offeringId",
            senderHciCode: "senderHciCode",
            senderInstitutionName: "senderInstitutionName",
            doctorMcr: "doctorMcr",
            doctorName: "doctorName",
            doctorEmail: "doctorEmail",
            doctorContactNumber: "doctorContactNumber",
            isSubsidised: true,
            isUrgent: true,
            isDraft: true,
            formResponses: [
                {
                    question: "question",
                    id: "id",
                    answer: "answer",
                },
            ],
        });
        expect(response).toEqual({
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [
                {
                    question: "question",
                    id: "id",
                    answer: "answer",
                },
            ],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [
                        {
                            question: "question",
                            id: "id",
                            answer: "answer",
                        },
                    ],
                },
            ],
            attachments: [
                {
                    url: "url",
                    name: "ecg-report.png",
                },
            ],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        });
    });

    test("upsert (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            patient: { uin: "uin", name: "name", phoneNumber: "phoneNumber", dob: "dob", gender: "Male" },
            offeringId: "offeringId",
            senderHciCode: "senderHciCode",
            senderInstitutionName: "senderInstitutionName",
            doctorMcr: "doctorMcr",
            doctorName: "doctorName",
            doctorEmail: "doctorEmail",
            doctorContactNumber: "doctorContactNumber",
            isSubsidised: true,
            isUrgent: true,
            isDraft: true,
            formResponses: [
                { question: "question", id: "id", answer: "answer" },
                { question: "question", id: "id", answer: "answer" },
            ],
        };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/api/v1/referrals")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.upsert({
                patient: {
                    uin: "uin",
                    name: "name",
                    phoneNumber: "phoneNumber",
                    dob: "dob",
                    gender: "Male",
                },
                offeringId: "offeringId",
                senderHciCode: "senderHciCode",
                senderInstitutionName: "senderInstitutionName",
                doctorMcr: "doctorMcr",
                doctorName: "doctorName",
                doctorEmail: "doctorEmail",
                doctorContactNumber: "doctorContactNumber",
                isSubsidised: true,
                isUrgent: true,
                isDraft: true,
                formResponses: [
                    {
                        question: "question",
                        id: "id",
                        answer: "answer",
                    },
                    {
                        question: "question",
                        id: "id",
                        answer: "answer",
                    },
                ],
            });
        }).rejects.toThrow(ReferralExchange.BadRequestError);
    });

    test("upsert (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            patient: { uin: "uin", name: "name", phoneNumber: "phoneNumber", dob: "dob", gender: "Male" },
            offeringId: "offeringId",
            senderHciCode: "senderHciCode",
            senderInstitutionName: "senderInstitutionName",
            doctorMcr: "doctorMcr",
            doctorName: "doctorName",
            doctorEmail: "doctorEmail",
            doctorContactNumber: "doctorContactNumber",
            isSubsidised: true,
            isUrgent: true,
            isDraft: true,
            formResponses: [
                { question: "question", id: "id", answer: "answer" },
                { question: "question", id: "id", answer: "answer" },
            ],
        };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/api/v1/referrals")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.upsert({
                patient: {
                    uin: "uin",
                    name: "name",
                    phoneNumber: "phoneNumber",
                    dob: "dob",
                    gender: "Male",
                },
                offeringId: "offeringId",
                senderHciCode: "senderHciCode",
                senderInstitutionName: "senderInstitutionName",
                doctorMcr: "doctorMcr",
                doctorName: "doctorName",
                doctorEmail: "doctorEmail",
                doctorContactNumber: "doctorContactNumber",
                isSubsidised: true,
                isUrgent: true,
                isDraft: true,
                formResponses: [
                    {
                        question: "question",
                        id: "id",
                        answer: "answer",
                    },
                    {
                        question: "question",
                        id: "id",
                        answer: "answer",
                    },
                ],
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("get (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [{ question: "question", id: "id", answer: "answer" }],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [{ question: "question", id: "id", answer: "answer" }],
                },
            ],
            attachments: [{ url: "url", name: "ecg-report.png" }],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
            timelineEvents: [
                {
                    type: "draft.created",
                    description: "PartnersBuddy rescheduled the appointment from 16 Dec, 10:00 PM to 21 Dec,11:00 PM",
                    producedAt: 1718764800000,
                    system: "HAS",
                },
            ],
            links: [{ type: "upsert", referralId: "referralId", url: "url" }],
            appointments: [
                {
                    status: "booked",
                    institutionName: "institutionName",
                    specialtyName: "specialtyName",
                    subSpecialtyName: "subSpecialtyName",
                    visitDateTime: "2024-01-15T09:30:00Z",
                    isDischarged: true,
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/api/v1/referrals/referralId")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.referrals.get({
            referralId: "referralId",
        });
        expect(response).toEqual({
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [
                {
                    question: "question",
                    id: "id",
                    answer: "answer",
                },
            ],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [
                        {
                            question: "question",
                            id: "id",
                            answer: "answer",
                        },
                    ],
                },
            ],
            attachments: [
                {
                    url: "url",
                    name: "ecg-report.png",
                },
            ],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
            timelineEvents: [
                {
                    type: "draft.created",
                    description: "PartnersBuddy rescheduled the appointment from 16 Dec, 10:00 PM to 21 Dec,11:00 PM",
                    producedAt: 1718764800000,
                    system: "HAS",
                },
            ],
            links: [
                {
                    type: "upsert",
                    referralId: "referralId",
                    url: "url",
                },
            ],
            appointments: [
                {
                    status: "booked",
                    institutionName: "institutionName",
                    specialtyName: "specialtyName",
                    subSpecialtyName: "subSpecialtyName",
                    visitDateTime: "2024-01-15T09:30:00Z",
                    isDischarged: true,
                },
            ],
        });
    });

    test("get (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/api/v1/referrals/referralId")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.get({
                referralId: "referralId",
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("get (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/api/v1/referrals/referralId")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.get({
                referralId: "referralId",
            });
        }).rejects.toThrow(ReferralExchange.NotFoundError);
    });

    test("delete (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [{ question: "question", id: "id", answer: "answer" }],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [{ question: "question", id: "id", answer: "answer" }],
                },
            ],
            attachments: [{ url: "url", name: "ecg-report.png" }],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        };
        server
            .mockEndpoint()
            .delete("/api/v1/referrals/referralId")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.referrals.delete({
            referralId: "referralId",
        });
        expect(response).toEqual({
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [
                {
                    question: "question",
                    id: "id",
                    answer: "answer",
                },
            ],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [
                        {
                            question: "question",
                            id: "id",
                            answer: "answer",
                        },
                    ],
                },
            ],
            attachments: [
                {
                    url: "url",
                    name: "ecg-report.png",
                },
            ],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        });
    });

    test("delete (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/api/v1/referrals/referralId")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.delete({
                referralId: "referralId",
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("cancel (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [{ question: "question", id: "id", answer: "answer" }],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [{ question: "question", id: "id", answer: "answer" }],
                },
            ],
            attachments: [{ url: "url", name: "ecg-report.png" }],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/cancel")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.referrals.cancel({
            referralId: "referralId",
        });
        expect(response).toEqual({
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [
                {
                    question: "question",
                    id: "id",
                    answer: "answer",
                },
            ],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [
                        {
                            question: "question",
                            id: "id",
                            answer: "answer",
                        },
                    ],
                },
            ],
            attachments: [
                {
                    url: "url",
                    name: "ecg-report.png",
                },
            ],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        });
    });

    test("cancel (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/cancel")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.cancel({
                referralId: "referralId",
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("amend (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { timeslotStartAt: 1714857600000 };
        const rawResponseBody = {
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [{ question: "question", id: "id", answer: "answer" }],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [{ question: "question", id: "id", answer: "answer" }],
                },
            ],
            attachments: [{ url: "url", name: "ecg-report.png" }],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/amend")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.referrals.amend({
            referralId: "referralId",
            timeslotStartAt: 1714857600000,
        });
        expect(response).toEqual({
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [
                {
                    question: "question",
                    id: "id",
                    answer: "answer",
                },
            ],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [
                        {
                            question: "question",
                            id: "id",
                            answer: "answer",
                        },
                    ],
                },
            ],
            attachments: [
                {
                    url: "url",
                    name: "ecg-report.png",
                },
            ],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        });
    });

    test("amend (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { timeslotStartAt: 1.1 };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/amend")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.amend({
                referralId: "referralId",
                timeslotStartAt: 1.1,
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("accept (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/accept")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.referrals.accept({
            referralId: "referralId",
        });
        expect(response).toEqual(undefined);
    });

    test("accept (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/accept")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.accept({
                referralId: "referralId",
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("reject (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { rejectionMessage: "rejectionMessage" };

        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/reject")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.referrals.reject({
            referralId: "referralId",
            rejectionMessage: "rejectionMessage",
        });
        expect(response).toEqual(undefined);
    });

    test("reject (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { rejectionMessage: "rejectionMessage" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/reject")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.reject({
                referralId: "referralId",
                rejectionMessage: "rejectionMessage",
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });

    test("backToDraft (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [{ question: "question", id: "id", answer: "answer" }],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [{ question: "question", id: "id", answer: "answer" }],
                },
            ],
            attachments: [{ url: "url", name: "ecg-report.png" }],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/back-to-draft")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.referrals.backToDraft({
            referralId: "referralId",
        });
        expect(response).toEqual({
            id: "id",
            sender: {
                hciCode: "hciCode",
                name: "name",
                block: "block",
                streetName: "streetName",
                buildingName: "buildingName",
                floorNumber: "floorNumber",
                unitNumber: "unitNumber",
                postalCode: "postalCode",
            },
            senderSystem: "HAS",
            offering: {
                id: "id",
                name: "name",
                institutionHciCode: "institutionHciCode",
                institution: {
                    hciCode: "hciCode",
                    name: "name",
                    block: "block",
                    streetName: "streetName",
                    buildingName: "buildingName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                    postalCode: "postalCode",
                },
                system: "HAS",
                description:
                    "Before proceeding with your referral, please refer to the guidelines of referrals to this SOC. https://go.gov.sg/refx-nuhs-gastro-guidelines",
                isActive: true,
                isSubsidisable: true,
                timeslotPolicy: "timeslot-required",
                category: "aac",
            },
            patient: {
                uin: "uin",
                name: "name",
                phoneNumber: "91234567",
                dob: "1990-01-01",
                gender: "Male",
                address: {
                    postalCode: "postalCode",
                    block: "block",
                    streetName: "streetName",
                    floorNumber: "floorNumber",
                    unitNumber: "unitNumber",
                },
                residentialStatus: "SC",
                isHsgEnrolled: true,
                chasStatus: "chasStatus",
            },
            referringDoctor: {
                mcr: "mcr",
                idType: "mcr",
                name: "name",
                email: "email",
                contactNumber: "contactNumber",
            },
            isSubsidised: true,
            isUrgent: true,
            createdAt: "2024-05-01T00:00:00Z",
            updatedAt: "2024-05-01T00:00:00Z",
            formResponses: [
                {
                    question: "question",
                    id: "id",
                    answer: "answer",
                },
            ],
            forms: [
                {
                    id: "id",
                    url: "url",
                    description: "description",
                    isFilled: true,
                    formResponses: [
                        {
                            question: "question",
                            id: "id",
                            answer: "answer",
                        },
                    ],
                },
            ],
            attachments: [
                {
                    url: "url",
                    name: "ecg-report.png",
                },
            ],
            url: "url",
            clinicLicenseNumber: "clinicLicenseNumber",
            clinicType: "CHAS-only",
            clinicalInfo: "clinicalInfo",
            status: "draft",
            timeslotStartAt: "2024-05-01T00:00:00Z",
            appointmentLocation: "appointmentLocation",
            notes: [
                {
                    id: "id",
                    content: "content",
                    authorHciCode: "authorHciCode",
                    authorName: "authorName",
                    createdAt: 1.1,
                    updatedAt: 1.1,
                },
            ],
        });
    });

    test("backToDraft (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ReferralExchangeClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/api/v1/referrals/referralId/back-to-draft")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.referrals.backToDraft({
                referralId: "referralId",
            });
        }).rejects.toThrow(ReferralExchange.UnauthorizedError);
    });
});
